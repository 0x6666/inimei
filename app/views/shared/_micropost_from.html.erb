<%= form_for(@micropost, html: {multipart: true}) do |f| %>
    <%= render 'shared/error_messages', object: f.object %>
    <div class="field">
      <%= f.text_area :content, placeholder: 'Compose new micropost...' %>
    </div>

    <div id="add_picture">
      <span class="btn change" id="picture_input">Choose Picture
        <%= f.file_field :picture, accept: 'image/jpeg,image/gif,image/png' %>
      </span>
    </div>

    <%= f.submit 'Post', class: 'btn btn-primary' %>
<% end %>

<script type="text/javascript">
  $('#micropost_picture').bind('change', function(){
      size_in_megabytes = this.files[0].size/1024/1024;
      if (size_in_megabytes > 5) {
          alert('Maximum file size is 5MB, Please choose a smaller file.')
      }
      else
      {
          // 检查是否支持FileReader对象
          if (typeof FileReader != 'undefined') {
              var acceptedTypes = {
                  'image/png': true,
                  'image/jpeg': true,
                  'image/gif': true
              };
              if (acceptedTypes[this.files[0].type] === true) {
                  var reader = new FileReader();
                  reader.onload = function (event) {
                      var image = new Image();
                      image.src = event.target.result;
                      image.width = 100;
                      document.getElementById('add_picture').insertBefore(image, document.getElementById('picture_input'));
                  };
                  reader.readAsDataURL(this.files[0]);
              }
          }
      }
  });
</script>